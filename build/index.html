<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="robots" content="noindex">

    <link rel="icon" type="image/png" href="https://editor.pixelcreator.io/images/favicon.png" />
    
    <title>Pixel Creator Â· Preview</title>
    
    <style>
* {
    margin: 0;
    padding: 0;
    user-select: none;
}

html, body {
    overflow: hidden;
    width: 100%;
    height: 100%;
    background-color: #000000;
}

canvas {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    margin: auto;
    image-rendering: crisp-edges;
    image-rendering: pixelated;
}
    </style>

    <!-- <script src="/socket.io/socket.io.js"></script> -->
    <!-- <script async type="module" id="app" src="./app.js"></script> -->
    <script saync type="module" id="app">
import {
    Scene,
    Renderer,
    Camera,
    Object,
    Time,
    Performance,
    Mouse,
    Keyboard,
    Network
} from 'https://editor.pixelcreator.io/src/core/mod.js';

// Get project ID
// const id = app.dataset ? app.dataset['id'] : null;
// console.log(`id: ${id}`);

const host = data.host;
const port = data.port;
const app = document.getElementById('app');
const renderer = new Renderer(window.innerWidth, window.innerHeight);

let scene = new Scene('Main Scene');
let camera = new Object();

/* Initialization */
async function init() {

    // Connect to main scene
    let objects = await Network.init(host, port).connect(scene);
    // let objects = data.objects;

    // Objects instantiating
    for (let id in objects) {

        scene.instanciate(objects[id]);

        // Camera initialization
        if (objects[id].components.Camera) {
            // obj.x -= obj.width / 2;
            // obj.y -= obj.height / 2;
            // obj.visible = false;
            camera.copy(objects[id]);
            camera.x -= camera.width / 2;
            camera.y -= camera.height / 2;
        }
    }

    // Scene initialization
    scene.init();

    renderer.init(scene, camera);
    // renderer.pause = false;

    // Start loop
    loop();
}

/* Game loop */
async function loop() {
    
    // Performance calculation
    Time.deltaTime = (Time.now() - Time.last) / (1000 / 60);
    Performance.update();

    window.requestAnimationFrame(loop);    
    renderer.render(scene, camera);

    Time.last = Time.current;
}

// Initialize on load
window.onload = init;

//  Window resized
window.onresize = function() {
    renderer.resize(window.innerWidth, window.innerHeight);
    renderer.init(scene, camera);
};

window.onbeforeunload = function(e) {
    Network.disconnect();
};

window.onunload = function(e) {
    Network.disconnect();
};
    </script>

</head>

<body>

</body>

</html>